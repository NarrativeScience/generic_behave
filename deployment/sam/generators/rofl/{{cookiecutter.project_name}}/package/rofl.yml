# This is an auto-generated example ROFL file. Check out the ROFL library
# documentation for how to modify this file:
# https://github.com/NarrativeScience/talos/tree/master/deployment/rofl
---
name: ROFL tasks for {{ cookiecutter.project_name }}

defaults:
  tasks:
    request:
      # When you're finished testing locally with a hard-coded base URL, you can set
      # this to `base_url_script: $.env.API_HOST` to read the value from the
      # environment within the Lambda function. Passing `--env-vars [path]` to
      # `sam local invoke` does not seem to work.
      base_url: https://httpbin.org
      authorization_script: "`Bearer ${$.event.user_token}`"
      timeout: 10000
      retry_count: 5
      retry_factor: 2
      retry_min_timeout: 1000
      retry_max_timeout: 60000
      retry_randomize: false
    log:
      level: info
    response:
      status_code: 200

tasks:
  - name: write story
    request:
      path: /post
      method: post
      body_script: $.event.story_params
    register: story

  - name: log the story
    log:
      message_script: >
        `Story: ${JSON.stringify($.story)}`

  - name: respond
    response:
      body_script:
        message: "`Email shared with ${$.event.email}`"
